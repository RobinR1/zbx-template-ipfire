zabbix_export:
  version: '5.4'
  date: '2022-02-08T20:01:39Z'
  groups:
    -
      uuid: a571c0d144b14fd4a87a9d9b2aa9fcd6
      name: Templates/Applications
    -
      uuid: 57b7ae836ca64446ba2c296389c009b7
      name: Templates/Modules
  templates:
    -
      uuid: 80543e3dcb9641a8a5a33554ad6638a9
      template: 'IPFire by Zabbix Agent Active'
      name: 'IPFire by Zabbix Agent Active'
      description: |
        Monitor an IPFire appliance
        
        Requirements for template operation:
        1.Install Zabbix agent addon using Pakfire
        2.Install fping addon using Pakfire
        3.Copy zabbix sudoers-file into folder with sudoers configuration (/etc/sudoers.d by default)
        4.Copy ipfire_services.pl into folder with Zabbix agent scripts (/etc/zabbix_agentd/scripts by default on IPFire) and make sure it is executable by the zabbix user.
        5.Copy 
          - template_ipfire_network_stats.conf
          - template_ipfire_services.conf
          - template_pakfire.conf
          into folder with Zabbix agent configuration (/etc/zabbix_agentd/zabbix_agentd.d/ by default on IPFire). 
        Don't forget to restart zabbix-agent.
        
        Created by Robin Roevens (robin.roevens (at) disroot.org)
      templates:
        -
          name: 'IPFire General stats by Zabbix Agent Active'
        -
          name: 'IPFire Network stats by Zabbix Agent Active'
        -
          name: 'IPFire Services by Zabbix Agent Active'
        -
          name: 'Pakfire by Zabbix Agent Active'
      groups:
        -
          name: Templates/Applications
    -
      uuid: 00ca0f238b54473899b640849252f83d
      template: 'IPFire General stats by Zabbix Agent Active'
      name: 'IPFire General stats by Zabbix Agent Active'
      description: |
        Monitor some IPFire general statistics
        
        Created by 
         - Robin Roevens (robin.roevens (at) disroot.org)
         - Stack Korora ( stackkorora (at) disroot.org )
      groups:
        -
          name: Templates/Modules
      items:
        -
          uuid: 3bec1fcf45174a0da4b701036a09beb1
          name: 'Captive Portal Clients'
          type: ZABBIX_ACTIVE
          key: ipfire.captive.clients
          history: 7d
          description: 'Number of active users on captive portal'
          tags:
            -
              tag: resource
              value: captive_portal
            -
              tag: target
              value: ipfire
            -
              tag: transport
              value: agent
            -
              tag: type
              value: gauge
        -
          uuid: ceef42e546444e75a4086bb71a30fc88
          name: 'RDRAND hardware support'
          type: ZABBIX_ACTIVE
          key: 'vfs.file.contents["/proc/cpuinfo"]'
          delay: 1h
          history: 7d
          description: 'Check if hardware has rdrand support.'
          valuemap:
            name: 'Boolean Yes/No'
          preprocessing:
            -
              type: REGEX
              parameters:
                - rdrand
                - '1'
              error_handler: CUSTOM_VALUE
              error_handler_params: '0'
          tags:
            -
              tag: resource
              value: randomness
            -
              tag: target
              value: ipfire
            -
              tag: transport
              value: agent
            -
              tag: type
              value: state
        -
          uuid: f140858d59d74c218bc76a31691df1c4
          name: Entropy
          type: ZABBIX_ACTIVE
          key: 'vfs.file.contents["/proc/sys/kernel/random/entropy_avail"]'
          history: 7d
          tags:
            -
              tag: resource
              value: randomness
            -
              tag: target
              value: ipfire
            -
              tag: transport
              value: agent
            -
              tag: type
              value: gauge
          triggers:
            -
              uuid: 7c76ea43522b451487eef2b7ff36370a
              expression: 'last(/IPFire General stats by Zabbix Agent Active/vfs.file.contents["/proc/sys/kernel/random/entropy_avail"])<{$IPFIRE.ENTROPY.MIN}'
              name: 'System is low on entropy'
              priority: WARNING
              description: 'The system has less than {$IPFIRE.ENTROPY.MIN} bits of entropy available.'
        -
          uuid: 36c13d71b65a4205b6a7e04b8a81fc43
          name: 'Random Number Generator Daemon'
          type: ZABBIX_ACTIVE
          key: 'vfs.file.exists["/var/run/rngd.pid"]'
          history: 7d
          description: 'Checks if Random Number Generator Daemon (rngd) is active.'
          valuemap:
            name: 'Service state'
          preprocessing:
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          tags:
            -
              tag: resource
              value: randomness
            -
              tag: target
              value: ipfire
            -
              tag: transport
              value: agent
            -
              tag: type
              value: state
      macros:
        -
          macro: '{$IPFIRE.ENTROPY.MIN}'
          value: '128'
          description: 'Minimal required entropy'
      valuemaps:
        -
          uuid: de7d41845c9e41ca86d15a8092181603
          name: 'Boolean Yes/No'
          mappings:
            -
              value: '0'
              newvalue: 'No'
            -
              value: '1'
              newvalue: 'Yes'
        -
          uuid: 8d3fa6d494e74178b90ebb18af4c0575
          name: 'Service state'
          mappings:
            -
              value: '0'
              newvalue: Down
            -
              value: '1'
              newvalue: Up
    -
      uuid: 35c8d311c2d64e7794e88693e741b2cc
      template: 'IPFire Network stats by Zabbix Agent Active'
      name: 'IPFire Network stats by Zabbix Agent Active'
      description: |
        Monitors IPFire network and firewall statistics.
        
        Created by 
         - Robin Roevens (robin.roevens (at) disroot.org)
         - Stack Korora ( stackkorora (at) disroot.org )
      groups:
        -
          name: Templates/Modules
      items:
        -
          uuid: 526aa253dee84833818a57efff79c9b1
          name: 'DHCP Server Leases'
          type: ZABBIX_ACTIVE
          key: ipfire.dhcp.clients
          history: 7d
          description: 'Number of active dhcpd leases'
          tags:
            -
              tag: resource
              value: dhcpd
            -
              tag: target
              value: ipfire
            -
              tag: transport
              value: agent
            -
              tag: type
              value: gauge
        -
          uuid: 9db4a6ab3fb74d98b947ceda614e1b87
          name: 'Get firewall hits'
          type: ZABBIX_ACTIVE
          key: ipfire.net.fw.hits.raw
          history: '0'
          trends: '0'
          value_type: TEXT
          description: 'Raw data item for retrieving firewall hits on all forwarding chains'
          tags:
            -
              tag: data
              value: raw
            -
              tag: resource
              value: firewall
            -
              tag: target
              value: ipfire
            -
              tag: transport
              value: agent
        -
          uuid: 0934274c7b8c442bacc8cf37103e7618
          name: 'Gateway available'
          type: ZABBIX_ACTIVE
          key: ipfire.net.gateway.ping
          history: 7d
          description: 'Checks if the internet gateway on RED is reachable'
          valuemap:
            name: 'Boolean Yes/No'
          tags:
            -
              tag: resource
              value: gateway
            -
              tag: target
              value: ipfire
            -
              tag: transport
              value: agent
            -
              tag: type
              value: gauge
          triggers:
            -
              uuid: 6b023c846dea444d851ea33db3bec9d2
              expression: 'last(/IPFire Network stats by Zabbix Agent Active/ipfire.net.gateway.ping)<>1'
              name: 'Internet Gateway is not reachable'
              priority: HIGH
              description: 'Internet Gateway on interface RED is unreachable. Internet connection is lost or intermittent.'
        -
          uuid: 9dd519fb1f0c44aebe35930b81926b40
          name: 'Gateway ping timings'
          type: ZABBIX_ACTIVE
          key: ipfire.net.gateway.pingtime
          history: 7d
          value_type: FLOAT
          units: ms
          description: 'Checks the response time of the internet gateway on RED'
          tags:
            -
              tag: resource
              value: gateway
            -
              tag: target
              value: ipfire
            -
              tag: transport
              value: agent
            -
              tag: type
              value: gauge
        -
          uuid: 39bfeb3c2ec74cb7bacf6ef9dc7f92b1
          name: 'Number of open connections'
          type: ZABBIX_ACTIVE
          key: 'vfs.file.contents["/proc/sys/net/netfilter/nf_conntrack_count"]'
          history: 7d
          tags:
            -
              tag: resource
              value: connection
            -
              tag: target
              value: ipfire
            -
              tag: transport
              value: agent
            -
              tag: type
              value: gauge
        -
          uuid: d2c54827bb8c491783ac58a257000bc5
          name: 'Max number of open connections'
          type: ZABBIX_ACTIVE
          key: 'vfs.file.contents["/proc/sys/net/netfilter/nf_conntrack_max"]'
          delay: 1h
          history: 7d
          tags:
            -
              tag: resource
              value: connection
            -
              tag: target
              value: ipfire
            -
              tag: transport
              value: agent
            -
              tag: type
              value: gauge
      discovery_rules:
        -
          uuid: 3ccca5d917944ca996ff7639bbb7ca0a
          name: 'Firewall chains discovery'
          type: DEPENDENT
          key: ipfire.net.fw.hits.discovery
          delay: '0'
          filter:
            conditions:
              -
                macro: '{#FW_CHAIN}'
                value: '{$IPFIRE.FW_CHAIN.MATCHES}'
                formulaid: A
              -
                macro: '{#FW_CHAIN}'
                value: '{$IPFIRE.FW_CHAIN.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: B
          description: 'Discovery of firewall chains in filter table to create "firewall hits" items/chain'
          item_prototypes:
            -
              uuid: c8724760ef754412abecc78168883fd8
              name: 'Firewall hits ({#FW_CHAIN})'
              type: DEPENDENT
              key: 'ipfire.net.fw.hits[{#FW_CHAIN}]'
              delay: '0'
              history: 7d
              units: bps
              description: 'Bytes dropped on firewall chain {#FW_CHAIN} of the Filter table'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[?(@.chain=="{#FW_CHAIN}")].bytes.first()'
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              master_item:
                key: ipfire.net.fw.hits.raw
              tags:
                -
                  tag: name
                  value: '{#FW_CHAIN}'
                -
                  tag: resource
                  value: firewall
                -
                  tag: target
                  value: ipfire
                -
                  tag: transport
                  value: dependent
                -
                  tag: type
                  value: rate
          master_item:
            key: ipfire.net.fw.hits.raw
          lld_macro_paths:
            -
              lld_macro: '{#FW_CHAIN}'
              path: $.chain
          preprocessing:
            -
              type: JAVASCRIPT
              parameters:
                - |
                  // Filter out toggling part: bytes
                  discovery_items = JSON.parse(value);
                  discovery_items.map(function (item) { delete item['bytes']; });
                  return JSON.stringify(discovery_items);
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
      macros:
        -
          macro: '{$IPFIRE.CONN.MAX}'
          value: '95'
          description: 'Max percentage of max open connections used before triggering warning'
        -
          macro: '{$IPFIRE.CONN.MAX_RESOLVE}'
          value: '85'
          description: 'Percentage of max open connections used before resolving trigger'
        -
          macro: '{$IPFIRE.FW_CHAIN.MATCHES}'
          value: '^.*$'
          description: 'Only discover firewall chains matching this regex'
        -
          macro: '{$IPFIRE.FW_CHAIN.NOT_MATCHES}'
          value: CHANGE_IF_NEEDED
          description: 'Do not discover firewall chains matching this regex'
      valuemaps:
        -
          uuid: c2c5240c9cf445f89d0e050941cda894
          name: 'Boolean Yes/No'
          mappings:
            -
              value: '0'
              newvalue: 'No'
            -
              value: '1'
              newvalue: 'Yes'
    -
      uuid: b00919cf9b15415da7ef3c1273afb0a8
      template: 'IPFire Services by Zabbix Agent Active'
      name: 'IPFire Services by Zabbix Agent Active'
      description: |
        Monitor status of IPFire Services
        
        Created by Robin Roevens (robin.roevens (at) disroot.org)
      groups:
        -
          name: Templates/Modules
      items:
        -
          uuid: eed7747d0c8147d29e98dcdc5e93eb18
          name: 'Get IPFire Services'
          type: ZABBIX_ACTIVE
          key: ipfire.services
          history: 1d
          trends: '0'
          value_type: TEXT
          description: 'Get a list of IPFire service using agent script ipfire_services.pl'
          tags:
            -
              tag: data
              value: raw
            -
              tag: resource
              value: service
            -
              tag: target
              value: ipfire
            -
              tag: transport
              value: agent
      discovery_rules:
        -
          uuid: 0836bc7a6f174f0b9efff1bf4da624a5
          name: 'IPFire Services discovery'
          type: DEPENDENT
          key: ipfire.services.discovery
          delay: '0'
          filter:
            conditions:
              -
                macro: '{#SERVICENAME}'
                value: '{$SERVICENAME.MATCHES}'
                formulaid: A
              -
                macro: '{#SERVICENAME}'
                value: '{$SERVICENAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: B
          item_prototypes:
            -
              uuid: 9258cc1a6ac7450285fca2cde66d7684
              name: '{#SERVICE} Memory usage'
              type: DEPENDENT
              key: 'ipfire.services.memory[{#SERVICENAME}]'
              delay: '0'
              history: 7d
              units: b
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[?(@.servicename == "{#SERVICENAME}")].memory.first()'
                  error_handler: DISCARD_VALUE
              master_item:
                key: ipfire.services
              tags:
                -
                  tag: name
                  value: '{#SERVICENAME}'
                -
                  tag: resource
                  value: memory
                -
                  tag: resource
                  value: service
                -
                  tag: target
                  value: ipfire
                -
                  tag: transport
                  value: dependent
                -
                  tag: type
                  value: gauge
            -
              uuid: 1586d60b5bd84ce197dbef29f5262972
              name: '{#SERVICE} Start on boot'
              type: DEPENDENT
              key: 'ipfire.services.onboot[{#SERVICENAME}]'
              delay: '0'
              history: 7d
              valuemap:
                name: 'Boolean Yes/No'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[?(@.servicename == "{#SERVICENAME}")].onboot.first()'
                  error_handler: CUSTOM_VALUE
                  error_handler_params: '1'
              master_item:
                key: ipfire.services
              tags:
                -
                  tag: name
                  value: '{#SERVICENAME}'
                -
                  tag: resource
                  value: service
                -
                  tag: target
                  value: ipfire
                -
                  tag: transport
                  value: dependent
                -
                  tag: type
                  value: state
            -
              uuid: fd7904d9617b4b799275926beb4f9bb1
              name: '{#SERVICE} Pid'
              type: DEPENDENT
              key: 'ipfire.services.pid[{#SERVICENAME}]'
              delay: '0'
              history: 7d
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[?(@.servicename == "{#SERVICENAME}")].pid.first()'
                  error_handler: DISCARD_VALUE
                -
                  type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: ipfire.services
              tags:
                -
                  tag: name
                  value: '{#SERVICENAME}'
                -
                  tag: resource
                  value: service
                -
                  tag: target
                  value: ipfire
                -
                  tag: transport
                  value: dependent
                -
                  tag: type
                  value: gauge
            -
              uuid: f5e6532e58e944a3bdfb7ef31f96b269
              name: '{#SERVICE} State'
              type: DEPENDENT
              key: 'ipfire.services.state[{#SERVICENAME}]'
              delay: '0'
              history: 7d
              valuemap:
                name: 'Service state'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[?(@.servicename == "{#SERVICENAME}")].state.first()'
              master_item:
                key: ipfire.services
              tags:
                -
                  tag: name
                  value: '{#SERVICENAME}'
                -
                  tag: resource
                  value: service
                -
                  tag: target
                  value: ipfire
                -
                  tag: transport
                  value: dependent
                -
                  tag: type
                  value: state
              trigger_prototypes:
                -
                  uuid: eea582bbd7264e9fb7120eb1010b721a
                  expression: '{$IPFIRE.SERVICE.TRIGGER:"{#SERVICENAME}"} and last(/IPFire Services by Zabbix Agent Active/ipfire.services.state[{#SERVICENAME}])<>1'
                  name: 'Service {#SERVICE} is not running'
                  priority: HIGH
                  description: 'The IPFire service {#SERVICE} is not running. If this service is manually disabled, set host macro $IPFIRE.SERVICE.TRIGGER:"{#SERVICENAME}" to 0 to disable this trigger.'
          master_item:
            key: ipfire.services
          lld_macro_paths:
            -
              lld_macro: '{#SERVICENAME}'
              path: $.servicename
            -
              lld_macro: '{#SERVICE}'
              path: $.service
          preprocessing:
            -
              type: JAVASCRIPT
              parameters:
                - |
                  // Filter out toggling parts: state, pid, memory, onboot
                  discovery_items = JSON.parse(value);
                  discovery_items.map(function (item) { ['state','pid','memory', 'onboot'].forEach(function(key) { delete item[key]; }) });
                  return JSON.stringify(discovery_items);
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
      macros:
        -
          macro: '{$IPFIRE.SERVICE.TRIGGER}'
          value: '1'
          description: 'Whether we need to trigger when a service is down. This variable can be used with context to exclude specific services.'
        -
          macro: '{$IPFIRE.SERVICENAME.MATCHES}'
          value: '^.*$'
          description: 'All services matching this regex will be discovered'
        -
          macro: '{$IPFIRE.SERVICENAME.NOT_MATCHES}'
          value: CHANGE_IF_NEEDED
          description: 'Services matching this regex will not be discovered'
      valuemaps:
        -
          uuid: 58f3ad1d5ea445e58b85c56abf0d63fa
          name: 'Boolean Yes/No'
          mappings:
            -
              value: '0'
              newvalue: 'No'
            -
              value: '1'
              newvalue: 'Yes'
        -
          uuid: 25494ff0217a48f1baca14d5d6019834
          name: 'Service state'
          mappings:
            -
              value: '0'
              newvalue: Down
            -
              value: '1'
              newvalue: Up
    -
      uuid: 152eb6a1f3e8445fbfad7698bf359343
      template: 'Pakfire by Zabbix Agent Active'
      name: 'Pakfire by Zabbix Agent Active'
      description: |
        Created by Alex Koch (ipfire (at) starkstromkonsument.de)
        Updated by Robin Roevens (robin.roevens (at) disroot.org)
      groups:
        -
          name: Templates/Applications
      items:
        -
          uuid: cd331422ea79494a89c7acdcd1bac1a5
          name: 'Core-Update available'
          type: DEPENDENT
          key: pakfire.core-update-available
          delay: '0'
          history: 7d
          valuemap:
            name: 'Boolean Yes/No'
          preprocessing:
            -
              type: REGEX
              parameters:
                - 'Core-Update available: (.*)'
                - \1
              error_handler: DISCARD_VALUE
            -
              type: JAVASCRIPT
              parameters:
                - |
                  // Convert Bool String to Bool Integer
                  switch(value) {
                     case "yes":
                        return 1;
                     case "no":
                        return 0;
                     default:
                        return 99;
                  }
            -
              type: IN_RANGE
              parameters:
                - '0'
                - '1'
              error_handler: CUSTOM_ERROR
              error_handler_params: 'Unknown value received'
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          master_item:
            key: pakfire.status
          tags:
            -
              tag: resource
              value: pakfire
            -
              tag: target
              value: ipfire
            -
              tag: transport
              value: dependent
            -
              tag: type
              value: state
          triggers:
            -
              uuid: d625869702694235b8939c10cdbd2332
              expression: 'last(/Pakfire by Zabbix Agent Active/pakfire.core-update-available)=1'
              name: 'Pakfire: Core-Update available'
              url: 'https://{HOST.CONN}:444/cgi-bin/pakfire.cgi'
              priority: INFO
              description: 'A Core-Update for IPFire is available. Go to the IPFire webgui > IPFire Pakfire to perform an update.'
            -
              uuid: 1dd66b7c912e4fadb759d73b20e7cddb
              expression: 'nodata(/Pakfire by Zabbix Agent Active/pakfire.core-update-available,4h)=1'
              name: 'Pakfire: Last Pakfire status update > 4h ago'
              priority: WARNING
              description: 'Zabbix was unable to retrieve Pakfire status for more than 4h. Check if Pakfire is still correctly working.'
        -
          uuid: c85773d59a8e4e8fa54b97e869211946
          name: Core-Update-Level
          type: DEPENDENT
          key: pakfire.core-update-level
          delay: '0'
          history: 7d
          preprocessing:
            -
              type: REGEX
              parameters:
                - 'Core-Update-Level: ([0-9]*)'
                - \1
              error_handler: DISCARD_VALUE
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          master_item:
            key: pakfire.status
          tags:
            -
              tag: resource
              value: pakfire
            -
              tag: target
              value: ipfire
            -
              tag: transport
              value: dependent
            -
              tag: type
              value: state
          triggers:
            -
              uuid: ebf7d76060b44f57b4ad236daaeff5b3
              expression: '(last(/Pakfire by Zabbix Agent Active/pakfire.core-update-level,#1)<>last(/Pakfire by Zabbix Agent Active/pakfire.core-update-level,#2))=1'
              name: 'Pakfire: Core-Update-Level has changed'
              priority: INFO
              dependencies:
                -
                  name: 'Pakfire: Core-Version has changed'
                  expression: '(last(/Pakfire by Zabbix Agent Active/pakfire.core-version,#1)<>last(/Pakfire by Zabbix Agent Active/pakfire.core-version,#2))=1'
        -
          uuid: c377aaed6a2f4532af32d7584926d4c8
          name: Core-Version
          type: DEPENDENT
          key: pakfire.core-version
          delay: '0'
          history: 7d
          value_type: FLOAT
          preprocessing:
            -
              type: REGEX
              parameters:
                - 'Core-Version: ([0-9.]*)'
                - \1
              error_handler: DISCARD_VALUE
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          master_item:
            key: pakfire.status
          tags:
            -
              tag: resource
              value: pakfire
            -
              tag: target
              value: ipfire
            -
              tag: transport
              value: dependent
            -
              tag: type
              value: state
          triggers:
            -
              uuid: 8d2a41a4dd4d4722ac6a35dd9847d56e
              expression: '(last(/Pakfire by Zabbix Agent Active/pakfire.core-version,#1)<>last(/Pakfire by Zabbix Agent Active/pakfire.core-version,#2))=1'
              name: 'Pakfire: Core-Version has changed'
              priority: INFO
        -
          uuid: 85aefb92c82b4bcc87b48d67e2d7ccd1
          name: 'Package-Updates available'
          type: DEPENDENT
          key: pakfire.package-updates-available
          delay: '0'
          history: 7d
          preprocessing:
            -
              type: REGEX
              parameters:
                - 'Package-Updates available: ([0-9]*)'
                - \1
              error_handler: DISCARD_VALUE
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          master_item:
            key: pakfire.status
          tags:
            -
              tag: resource
              value: pakfire
            -
              tag: target
              value: ipfire
            -
              tag: transport
              value: dependent
            -
              tag: type
              value: state
          triggers:
            -
              uuid: 26b529849d9e48cdbbcf27c3061a0881
              expression: 'last(/Pakfire by Zabbix Agent Active/pakfire.package-updates-available)>0'
              name: 'Pakfire: Package-Updates available'
              priority: INFO
        -
          uuid: 366eb5f71bfe4a0b81cf514684d69aa1
          name: 'Reboot required'
          type: DEPENDENT
          key: pakfire.reboot-required
          delay: '0'
          history: 7d
          valuemap:
            name: 'Boolean Yes/No'
          preprocessing:
            -
              type: REGEX
              parameters:
                - 'Reboot required: (.*)'
                - \1
              error_handler: DISCARD_VALUE
            -
              type: JAVASCRIPT
              parameters:
                - |
                  // Convert Bool String to Bool Integer
                  switch(value) {
                     case "yes":
                        return 1;
                     case "no":
                        return 0;
                     default:
                        return 99;
                  }
            -
              type: IN_RANGE
              parameters:
                - '0'
                - '1'
              error_handler: CUSTOM_ERROR
              error_handler_params: 'Unknown value received'
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          master_item:
            key: pakfire.status
          tags:
            -
              tag: resource
              value: pakfire
            -
              tag: target
              value: ipfire
            -
              tag: transport
              value: dependent
            -
              tag: type
              value: state
          triggers:
            -
              uuid: cf28c5c43c0146228761773117205490
              expression: 'last(/Pakfire by Zabbix Agent Active/pakfire.reboot-required)=1'
              name: 'Pakfire: Reboot required'
              url: 'https://{HOST.CONN}:444/cgi-bin/shutdown.cgi'
              priority: INFO
              description: 'An update requires a reboot of IPFire to complete. Please reboot the host as soon as possible. Go to the IPFire webgui > System > Shutdown to perform a reboot.'
        -
          uuid: 5de527d1530c4d14a21643505c754cf0
          name: 'Get Pakfire Status'
          type: ZABBIX_ACTIVE
          key: pakfire.status
          delay: 10m
          history: '0'
          trends: '0'
          value_type: TEXT
          tags:
            -
              tag: data
              value: raw
            -
              tag: resource
              value: pakfire
            -
              tag: target
              value: ipfire
            -
              tag: transport
              value: agent
        -
          uuid: 6b5b61efbb9e494b8f12cb1e1890a728
          name: 'Last update'
          type: ZABBIX_ACTIVE
          key: 'vfs.file.time["/opt/pakfire/db/core/mine",modify]'
          delay: 10m
          history: 7d
          units: unixtime
          preprocessing:
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          tags:
            -
              tag: resource
              value: pakfire
            -
              tag: target
              value: ipfire
            -
              tag: transport
              value: agent
            -
              tag: type
              value: state
        -
          uuid: 7c3a65318aee4e259025eb1f08b41573
          name: 'Last core-list update'
          type: ZABBIX_ACTIVE
          key: 'vfs.file.time["/opt/pakfire/db/lists/core-list.db",modify]'
          delay: 10m
          history: 7d
          units: unixtime
          preprocessing:
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          tags:
            -
              tag: resource
              value: pakfire
            -
              tag: target
              value: ipfire
            -
              tag: transport
              value: agent
            -
              tag: type
              value: state
          triggers:
            -
              uuid: 0e9e65cda7c44383826dbc49e5fefccc
              expression: 'fuzzytime(/Pakfire by Zabbix Agent Active/vfs.file.time["/opt/pakfire/db/lists/core-list.db",modify],49h)=0'
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: 'fuzzytime(/Pakfire by Zabbix Agent Active/vfs.file.time["/opt/pakfire/db/lists/core-list.db",modify],1h)=1'
              name: 'Pakfire: Last core-list update > 49h ago'
              priority: WARNING
              description: 'Auslösung bei Delta > 49h / Recovery bei Delta < 1h'
              dependencies:
                -
                  name: 'Pakfire: Last server-list update > 49h ago'
                  expression: 'fuzzytime(/Pakfire by Zabbix Agent Active/vfs.file.time["/opt/pakfire/db/lists/server-list.db",modify],49h)=0'
                  recovery_expression: 'fuzzytime(/Pakfire by Zabbix Agent Active/vfs.file.time["/opt/pakfire/db/lists/server-list.db",modify],1h)=1'
        -
          uuid: e1643129026a4ab5a9c4bae33bdf5b80
          name: 'Last packages-list update'
          type: ZABBIX_ACTIVE
          key: 'vfs.file.time["/opt/pakfire/db/lists/packages_list.db",modify]'
          delay: 10m
          history: 7d
          units: unixtime
          preprocessing:
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          tags:
            -
              tag: resource
              value: pakfire
            -
              tag: target
              value: ipfire
            -
              tag: transport
              value: agent
            -
              tag: type
              value: state
          triggers:
            -
              uuid: cc3eef38bc39462f80256d4533dbc4cc
              expression: 'fuzzytime(/Pakfire by Zabbix Agent Active/vfs.file.time["/opt/pakfire/db/lists/packages_list.db",modify],49h)=0'
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: 'fuzzytime(/Pakfire by Zabbix Agent Active/vfs.file.time["/opt/pakfire/db/lists/packages_list.db",modify],1h)=1'
              name: 'Pakfire: Last packages-list update > 49h ago'
              priority: WARNING
              description: 'Auslösung bei Delta > 49h / Recovery bei Delta < 1h'
              dependencies:
                -
                  name: 'Pakfire: Last server-list update > 49h ago'
                  expression: 'fuzzytime(/Pakfire by Zabbix Agent Active/vfs.file.time["/opt/pakfire/db/lists/server-list.db",modify],49h)=0'
                  recovery_expression: 'fuzzytime(/Pakfire by Zabbix Agent Active/vfs.file.time["/opt/pakfire/db/lists/server-list.db",modify],1h)=1'
        -
          uuid: ba302fba7fd946f28ac01da9fd45e4b4
          name: 'Last server-list update'
          type: ZABBIX_ACTIVE
          key: 'vfs.file.time["/opt/pakfire/db/lists/server-list.db",modify]'
          delay: 10m
          history: 7d
          units: unixtime
          preprocessing:
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          tags:
            -
              tag: resource
              value: pakfire
            -
              tag: target
              value: ipfire
            -
              tag: transport
              value: agent
            -
              tag: type
              value: state
          triggers:
            -
              uuid: 9ea7c98717274227b28bc16e80537a67
              expression: 'fuzzytime(/Pakfire by Zabbix Agent Active/vfs.file.time["/opt/pakfire/db/lists/server-list.db",modify],49h)=0'
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: 'fuzzytime(/Pakfire by Zabbix Agent Active/vfs.file.time["/opt/pakfire/db/lists/server-list.db",modify],1h)=1'
              name: 'Pakfire: Last server-list update > 49h ago'
              priority: WARNING
              description: 'Auslösung bei Delta > 49h / Recovery bei Delta < 1h'
      tags:
        -
          tag: Service
          value: Pakfire
      valuemaps:
        -
          uuid: ff125c88f89c4d2eb753b684d1bc7fe3
          name: 'Boolean Yes/No'
          mappings:
            -
              value: '0'
              newvalue: 'No'
            -
              value: '1'
              newvalue: 'Yes'
  triggers:
    -
      uuid: 4b16032b37c445208365788160ed69b2
      expression: 'last(/IPFire Network stats by Zabbix Agent Active/vfs.file.contents["/proc/sys/net/netfilter/nf_conntrack_count"])/last(/IPFire Network stats by Zabbix Agent Active/vfs.file.contents["/proc/sys/net/netfilter/nf_conntrack_max"])*100>{$IPFIRE.CONN.MAX}'
      recovery_mode: RECOVERY_EXPRESSION
      recovery_expression: 'last(/IPFire Network stats by Zabbix Agent Active/vfs.file.contents["/proc/sys/net/netfilter/nf_conntrack_count"])/last(/IPFire Network stats by Zabbix Agent Active/vfs.file.contents["/proc/sys/net/netfilter/nf_conntrack_max"])*100<={$IPFIRE.CONN.MAX_RESOLVE}'
      name: 'Number of open connection is too high (> 90% of max open connections)'
      opdata: 'Open connections: {ITEM.LASTVALUE1}, Max open connections: {ITEM.LASTVALUE2}'
      priority: WARNING
      description: |
        The current number of open connections is at {$IPFIRE.CONN.MAX}% of the max allowed number of open connections. When the max allowed number of open connections is reached, new connections will be dropped. 
        Consider increasing the net.netfilter.nf_conntrack_max system variable.
    -
      uuid: 1b4170d70b0b4e72874882be4a99d801
      expression: 'last(/IPFire General stats by Zabbix Agent Active/vfs.file.contents["/proc/cpuinfo"])=1 and last(/IPFire General stats by Zabbix Agent Active/vfs.file.exists["/var/run/rngd.pid"])<>1'
      name: 'Random Number Generator Daemon is not running'
      priority: WARNING
      description: 'A hardware random number source is found but the random number generator daemon is not running to inject randomness from the hardware into the kernel entropy pool.'
  graphs:
    -
      uuid: 51c44e0490374cbcb4099a716d69c08a
      name: Entropy
      graph_items:
        -
          sortorder: '1'
          drawtype: BOLD_LINE
          color: FF0000
          item:
            host: 'IPFire General stats by Zabbix Agent Active'
            key: 'vfs.file.contents["/proc/sys/kernel/random/entropy_avail"]'
    -
      uuid: 0a5b32395b924093b18fdda2123b1aaa
      name: 'Line Quality'
      graph_items:
        -
          sortorder: '1'
          drawtype: GRADIENT_LINE
          color: 1A7C11
          item:
            host: 'IPFire Network stats by Zabbix Agent Active'
            key: ipfire.net.gateway.pingtime
    -
      uuid: bbafe831e70a4db3b186241e4c927dd4
      name: 'Open Connections'
      graph_items:
        -
          sortorder: '1'
          color: FF0000
          item:
            host: 'IPFire Network stats by Zabbix Agent Active'
            key: 'vfs.file.contents["/proc/sys/net/netfilter/nf_conntrack_count"]'
